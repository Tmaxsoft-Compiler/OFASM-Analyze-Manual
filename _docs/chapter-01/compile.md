---
title: 컴파일 방법
category: Chapter 01
order: 2
---

## 컴파일

어셈블러 소스 파일(.asm 파일)을 실행 가능한 오브젝트 파일(.asmo)로 변환하는 과정을 컴파일 과정이라고 한다. 어셈블러 소스 파일은 .asm 확장자를 가지고 있어야하며, 그렇지 않으면 어셈블러 소스로 간주하지 않는다. 또한 어셈블러 소스 컴파일에 필요한 매크로 및 카피북은 모두 환경변수 $OFASM_MACLIB에 정의된 경로들에 위치해야 한다. 카피북 및 매크로파일은 .cpy 혹은 .mac 확장자를 가지거나, 확장자 자체를 가지지 않아도 무방하다.
어셈블러 소스 파일의 컴파일은 전처리, 그리고 어셈블리 두 가지 단계를 거쳐서 완료된다.

### 전처리 단계

전처리 단계는 어셈블러 소스 파일(.asm)을 전처리된 파일 혹은 중간 단계 파일(.asmi)로 변환하는 단계를 말한다. 이 단계에서는 .asm 파일에서 사용되는 모든 매크로 및 카피북, CICS 커맨드들이 기본적인 기계 명령어 및 어셈블리 명령어들로 변환된다.

ofasm 명령어를 사용하여 TEST.asm 파일을 TEST.asmi 파일로 전처리하는 것은 아래와 같은 커맨드를 입력하여 수행할 수 있다.

<pre>
    ofasm -E TEST.asm
</pre>

혹은 아래와 같은 방법을 이용할 수도 있다.

<pre>
    ofasmpp -i TEST.asm -o TEST.asmi
</pre>




### 어셈블리 단계

어셈블리 단계는 중간 단계 파일(.asmi)을 오브젝트 파일 혹은 목적코드 파일(.asmo)로 변환하는 단계를 말한다. 오브젝트 파일은 OFASM VM이 직접 실행할 수 있는 형태의 바이너리 파일이다.

ofasm 명령어를 사용하여 TEST.asmi 파일을 TEST.asmo 파일로 어셈블리 하는 것은 아래와 같은 커맨드를 입력하여 수행할 수 있다.

<pre>
    ofasm -S TEST.asmi
</pre>

혹은 아래와 같은 방법을 이용할 수도 있다.

<pre>
    ofasma -i TEST.asmi -o TEST.asmo
</pre>


### 통합 컴파일

일반적으로는 전처리 단계와 어셈블리 단계를 나눠서 거치지 않고, 아래와 같이 ofasm 명령어를 이용하여 소스 코드(.asm) 파일에서 오브젝트 파일(.asmo)로 곧바로 컴파일을 수행한다.

<pre>
    ofasm TEST.asm
</pre>

이 때, 전처리 단계와 어셈블리 단계를 모두 거친 것처럼 .asmi 파일과 .asmo 파일이 동시에 생성된다.

ofasm 명령어를 사용하여 컴파일을 할 때 사용할 수 있는 옵션들은 아래와 같다

|   옵션            |   설명                                                                |
|   --enable-cics   |   CICS 구문을 전처리 하기 위해 사용                                   |
|   --list          |   OFASM에서 내부적으로 지원하는 매크로, 카피북 및 명령어들을 출력한다 |


//TODO
컴파일 개요
전처리 단계
    전처리란?
    전처리 방법
    전처리과정에서 발생하는 에러 및 대응 방법
어셈블리 단계
    어셈블리란?
    어셈블리 방법
    어셈블리 과정에서 발생하는 에러 및 대응 방법
각 바이너리(ofasmpp, ofasma)의 옵션들 정리